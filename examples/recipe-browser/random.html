<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ricetta Casuale - Recipe Browser</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="header">
        <h1>⊛ Ricetta Casuale</h1>
        <p>Lasciati sorprendere da una ricetta casuale</p>
    </header>

    <nav class="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-link">⌂ Home</a>
            <a href="categories.html" class="nav-link">⊞ Categorie</a>
            <a href="search.html" class="nav-link">⊙ Cerca</a>
            <a href="random.html" class="nav-link active">⊛ Casuale</a>
        </div>
    </nav>

    <div class="container">
        <div class="search-section">
            <h2 style="margin-bottom: 1rem; color: var(--text-dark);">Scopri qualcosa di nuovo!</h2>
            <p style="color: var(--text-light); margin-bottom: 2rem;">
                Non sai cosa cucinare? Clicca il pulsante qui sotto per ottenere una ricetta completamente casuale.
                È il modo perfetto per scoprire nuovi piatti e ampliare i tuoi orizzonti culinari!
            </p>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <button onclick="getRandomMeal()" class="btn" style="font-size: 1.2rem; padding: 1.2rem 2.5rem;">
                    ⊛ Ottieni Ricetta Casuale
                </button>
            </div>
            
            <div style="text-align: center;">
                <button onclick="getMultipleRandom()" class="btn btn-secondary" style="margin-right: 1rem;">
                    ◉ 3 Ricette Casuali
                </button>
                <button onclick="getRandomByCategory()" class="btn btn-secondary">
                    ⊞ Casuale per Categoria
                </button>
            </div>
        </div>

        <!-- Sezione categoria casuale -->
        <div id="categorySection" style="display: none;" class="search-section">
            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">Ricetta casuale per categoria</h3>
            <div class="search-container">
                <select id="categorySelect" class="search-input">
                    <option value="">Caricamento categorie...</option>
                </select>
                <button onclick="getRandomFromCategory()" class="search-btn">🎲 Ricetta Casuale</button>
            </div>
        </div>

        <!-- Risultati -->
        <div id="randomResults" style="display: none;">
            <div class="search-section">
                <h3 id="resultsTitle" style="color: var(--text-dark);">Le tue ricette casuali</h3>
                <p style="color: var(--text-light);">Clicca su una ricetta per vedere tutti i dettagli</p>
                <button onclick="clearResults()" class="btn btn-secondary" style="margin-top: 1rem;">
                    ✨ Nuove Ricette
                </button>
            </div>
            <div id="resultsContainer" class="recipes-grid"></div>
        </div>

        <!-- Statistiche curiose -->
        <div class="search-section" style="margin-top: 3rem;">
            <h3 style="color: var(--text-dark); margin-bottom: 1rem;">📊 Lo sapevi che...</h3>
            <div id="funFacts" style="color: var(--text-light); line-height: 1.8;">
                <div class="loading">Caricamento statistiche curiose...</div>
            </div>
        </div>
    </div>

    <style>
        select.search-input {
            appearance: none;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6,9 12,15 18,9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1rem;
            padding-right: 3rem;
        }

        .fun-fact {
            background: var(--background-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
        }
    </style>

    <script>
        const API_BASE = 'https://www.themealdb.com/api/json/v1/1/';

        // Ottieni una ricetta casuale
        async function getRandomMeal() {
            showLoading('Scegliendo una ricetta casuale per te...');
            
            try {
                const response = await fetch(`${API_BASE}random.php`);
                const data = await response.json();
                
                if (data.meals && data.meals[0]) {
                    displayResults([data.meals[0]], 'La tua ricetta casuale');
                } else {
                    showError('Impossibile ottenere una ricetta casuale');
                }
            } catch (error) {
                console.error('Errore:', error);
                showError('Errore nel caricamento della ricetta casuale');
            }
        }

        // Ottieni più ricette casuali
        async function getMultipleRandom() {
            showLoading('Preparando 3 ricette casuali...');
            
            try {
                const promises = Array(3).fill().map(() => fetch(`${API_BASE}random.php`));
                const responses = await Promise.all(promises);
                const data = await Promise.all(responses.map(r => r.json()));
                
                const meals = data.map(d => d.meals[0]).filter(Boolean);
                
                if (meals.length > 0) {
                    displayResults(meals, '3 ricette casuali per te');
                } else {
                    showError('Impossibile ottenere ricette casuali');
                }
            } catch (error) {
                console.error('Errore:', error);
                showError('Errore nel caricamento delle ricette casuali');
            }
        }

        // Mostra/nascondi sezione categoria
        function getRandomByCategory() {
            const section = document.getElementById('categorySection');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
            
            if (section.style.display === 'block') {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Ottieni ricetta casuale da categoria specifica
        async function getRandomFromCategory() {
            const category = document.getElementById('categorySelect').value;
            if (!category) {
                alert('Seleziona una categoria');
                return;
            }

            showLoading(`Cercando una ricetta casuale di ${category}...`);
            
            try {
                // Prima ottieni tutte le ricette della categoria
                const response = await fetch(`${API_BASE}filter.php?c=${encodeURIComponent(category)}`);
                const data = await response.json();
                
                if (data.meals && data.meals.length > 0) {
                    // Scegli una ricetta casuale dalla lista
                    const randomIndex = Math.floor(Math.random() * data.meals.length);
                    const randomMeal = data.meals[randomIndex];
                    
                    // Ottieni i dettagli completi
                    const detailResponse = await fetch(`${API_BASE}lookup.php?i=${randomMeal.idMeal}`);
                    const detailData = await detailResponse.json();
                    
                    if (detailData.meals && detailData.meals[0]) {
                        displayResults([detailData.meals[0]], `Ricetta casuale di ${category}`);
                    } else {
                        displayResults([randomMeal], `Ricetta casuale di ${category}`);
                    }
                } else {
                    showError(`Nessuna ricetta trovata per ${category}`);
                }
            } catch (error) {
                console.error('Errore:', error);
                showError('Errore nel caricamento della ricetta casuale per categoria');
            }
        }

        // Mostra i risultati
        function displayResults(meals, title) {
            const resultsSection = document.getElementById('randomResults');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsContainer = document.getElementById('resultsContainer');

            resultsTitle.textContent = title;
            resultsSection.style.display = 'block';
            
            resultsContainer.innerHTML = meals.map(meal => `
                <div class="recipe-card" onclick="window.location.href='recipe-detail.html?id=${meal.idMeal}'">
                    <img src="${meal.strMealThumb}" alt="${meal.strMeal}" class="recipe-image">
                    <div class="recipe-info">
                        <h3 class="recipe-name">${meal.strMeal}</h3>
                        ${meal.strCategory ? `<span class="recipe-category">${meal.strCategory}</span>` : ''}
                        ${meal.strArea ? `<p class="recipe-area">◎ ${meal.strArea}</p>` : ''}
                    </div>
                </div>
            `).join('');
            
            // Animazione fade-in
            resultsContainer.querySelectorAll('.recipe-card').forEach((card, index) => {
                card.style.animationDelay = `${index * 0.2}s`;
                card.classList.add('fade-in');
            });
            
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Mostra loading
        function showLoading(message) {
            const resultsSection = document.getElementById('randomResults');
            const resultsContainer = document.getElementById('resultsContainer');
            
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = `<div class="loading">${message}</div>`;
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Mostra errore
        function showError(message) {
            const resultsSection = document.getElementById('randomResults');
            const resultsContainer = document.getElementById('resultsContainer');
            
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = `<div class="error">${message}</div>`;
        }

        // Pulisci risultati
        function clearResults() {
            document.getElementById('randomResults').style.display = 'none';
            document.getElementById('categorySection').style.display = 'none';
        }

        // Carica le categorie
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}categories.php`);
                const data = await response.json();
                
                const select = document.getElementById('categorySelect');
                select.innerHTML = '<option value="">Seleziona una categoria</option>' + 
                    data.categories.map(category => 
                        `<option value="${category.strCategory}">${category.strCategory}</option>`
                    ).join('');
            } catch (error) {
                console.error('Errore nel caricamento categorie:', error);
            }
        }

        // Carica fatti curiosi
        async function loadFunFacts() {
            const factsContainer = document.getElementById('funFacts');
            
            try {
                // Ottieni statistiche dalle categorie
                const categoriesResponse = await fetch(`${API_BASE}categories.php`);
                const categoriesData = await categoriesResponse.json();
                
                // Ottieni alcune aree
                const areasResponse = await fetch(`${API_BASE}list.php?a=list`);
                const areasData = await areasResponse.json();
                
                const facts = [
                    `🍽️ Ci sono <strong>${categoriesData.categories.length}</strong> categorie di ricette disponibili`,
                    `🌍 Puoi esplorare cucine da <strong>${areasData.meals.length}</strong> paesi diversi`,
                    `🎲 Ogni ricetta casuale è scelta da migliaia di possibilità`,
                    `📚 Il database contiene ricette tradizionali e moderne da tutto il mondo`,
                    `🔍 Puoi trovare ricette per qualsiasi ingrediente tu abbia in casa`
                ];
                
                factsContainer.innerHTML = facts.map(fact => 
                    `<div class="fun-fact">${fact}</div>`
                ).join('');
                
            } catch (error) {
                console.error('Errore nel caricamento facts:', error);
                factsContainer.innerHTML = `
                    <div class="fun-fact">
                        🎲 Ogni ricetta casuale è un'avventura culinaria unica!
                    </div>
                `;
            }
        }

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            loadFunFacts();
        });
    </script>
</body>
</html>
