<div class="container">
    <div class="search-section">
        <h2>Trova la tua ricetta ideale</h2>

        <!-- Schede di ricerca -->
        <div class="search-tabs">
            <button @class="{'search-tab': true, 'active': searchType === 'name'}" @click="searchType = 'name'" data-type="name">◐ Per Nome</button>
            <button @class="{'search-tab': true, 'active': searchType === 'ingredient'}" @click="searchType = 'ingredient'" data-type="ingredient">◎ Per Ingrediente</button>
            <button @class="{'search-tab': true, 'active': searchType === 'area'}" @click="searchType = 'area'" data-type="area">◒ Per Area</button>
            <button @class="{'search-tab': true, 'active': searchType === 'letter'}" @click="searchType = 'letter'" data-type="letter">◉ Per Lettera</button>
        </div>

        <init>
            loading=false
        </init>

        <!-- Form ricerca per nome -->
        <div @if="searchType === 'name'" class="search-form">
            <div class="search-container">
                <input type="text" @model="searchQuery" class="search-input"
                    placeholder="Inserisci il nome della ricetta (es. Arrabiata)">
                <button @click="loading = true" class="search-btn">⊙ Cerca</button>
            </div>
        </div>

        <!-- Form ricerca per ingrediente -->
        <div @if="searchType === 'ingredient'" class="search-form">
            <div class="search-container">
                <input type="text" @model="searchIngredient" class="search-input"
                    placeholder="Inserisci l'ingrediente (es. chicken)">
                <button @click="loading = true" class="search-btn">⊙ Cerca</button>
            </div>
        </div>

        <!-- Form ricerca per area -->
        <div @if="searchType === 'area'" class="search-form">
            <div class="search-container">
                <select @model="searchArea" class="search-input">
                    <option value="">Seleziona un'area geografica</option>
                    <option value="Italian">Italiana</option>
                    <option value="American">Americana</option>
                    <option value="British">Britannica</option>
                    <option value="Canadian">Canadese</option>
                    <option value="Chinese">Cinese</option>
                    <option value="Croatian">Croata</option>
                    <option value="Dutch">Olandese</option>
                    <option value="Egyptian">Egiziana</option>
                    <option value="French">Francese</option>
                    <option value="Greek">Greca</option>
                    <option value="Indian">Indiana</option>
                    <option value="Irish">Irlandese</option>
                    <option value="Japanese">Giapponese</option>
                    <option value="Jamaican">Giamaicana</option>
                    <option value="Kenyan">Keniota</option>
                    <option value="Malaysian">Malese</option>
                    <option value="Mexican">Messicana</option>
                    <option value="Moroccan">Marocchina</option>
                    <option value="Polish">Polacca</option>
                    <option value="Portuguese">Portoghese</option>
                    <option value="Russian">Russa</option>
                    <option value="Spanish">Spagnola</option>
                    <option value="Thai">Thai</option>
                    <option value="Tunisian">Tunisina</option>
                    <option value="Turkish">Turca</option>
                    <option value="Unknown">Sconosciuta</option>
                    <option value="Vietnamese">Vietnamita</option>
                </select>
                <button @click="loading = true" class="search-btn">⊙ Cerca</button>
            </div>
        </div>

        <!-- Form ricerca per lettera -->
        <div @if="searchType === 'letter'" class="search-form">
            <div class="search-container">
                <select @model="searchLetter" class="search-input">
                    <option @for="letter in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('')" @value="letter" @text="letter">
                    </option>
                </select>
                <button @click="loading = true" class="search-btn">⊙ Cerca</button>
            </div>
        </div>
    </div>

    <!-- Fetch dei risultati in base al tipo di ricerca -->
    <div @if="searchType === 'name' && searchQuery && loading"
        @fetch="https://www.themealdb.com/api/json/v1/1/search.php?s={searchQuery}" @result="searchResultsData"
        @watch="searchQuery"></div>

    <div @if="searchType === 'ingredient' && searchIngredient && loading"
        @fetch="https://www.themealdb.com/api/json/v1/1/filter.php?i={searchIngredient}" @result="searchResultsData"
        @watch="searchIngredient"></div>

    <div @if="searchType === 'area' && searchArea && loading"
        @fetch="`https://www.themealdb.com/api/json/v1/1/filter.php?a=${searchArea}`" @result="searchResultsData"
        @watch="searchArea"></div>

    <div @if="searchType === 'letter' && searchLetter && loading"
        @fetch="`https://www.themealdb.com/api/json/v1/1/search.php?f=${searchLetter}`" @result="searchResultsData"
        @watch="searchLetter"></div>

    <!-- Processing dei risultati -->
    <div @watch="searchResultsData?.meals: loading = false"></div>

    <!-- Mostra i risultati -->
    <div @if="searchResultsData?.meals && searchResultsData?.meals.length > 0">
        <h3 style="margin: 2rem 0; color: var(--text-dark);">
            Trovate <span @text="searchResultsData?.meals.length"></span> ricette
        </h3>
        <div class="recipes-grid">
            <div @for="recipe in searchResultsData?.meals" @key="recipe.idMeal" class="recipe-card fade-in"
                @click="selectedMealId = recipe.idMeal"  @link="recipe-detail">
                <img src="{{recipe.strMealThumb}}" alt="{{recipe.strMeal}}" class="recipe-image">
                <div class="recipe-info">
                    <h3 class="recipe-name" @text="recipe.strMeal"></h3>
                    <span @if="recipe.strCategory" class="recipe-category" @text="recipe.strCategory"></span>
                    <p @if="recipe.strArea" class="recipe-area">◎ <span @text="recipe.strArea"></span></p>
                </div>
            </div>
        </div>
    </div>

    <div @if="loading" class="loading">Ricerca in corso...</div>
    <div @if="!loading && searchResultsData?.meals && searchResultsData?.meals.length === 0 && (searchQuery || searchIngredient || searchArea || searchLetter)"
        class="error">
        Nessuna ricetta trovata. Prova con altri termini di ricerca.
    </div>
</div>